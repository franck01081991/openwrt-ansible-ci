# Generated by Ansible

# Bridge device for LAN (DSA)
config device
        option name '{{ network.lan.device }}'
        option type 'bridge'
{% for p in network.bridge_ports %}
        list ports '{{ p }}'
{% endfor %}

config interface 'lan'
        option device '{{ network.lan.device }}'
        option proto 'static'
        option ipaddr '{{ network.lan.ip }}'
        option netmask '{{ network.lan.netmask }}'

config interface 'wan'
        option device '{{ network.wan.device }}'
        option proto '{{ network.wan.proto | default("dhcp") }}'

{% if wireguard.enabled %}
{% for iface in wireguard.interfaces %}
config interface '{{ iface.name }}'
        option proto 'wireguard'
        list addresses '{{ iface.address }}'
        option listen_port '{{ iface.listen_port }}'
        option private_key '{{ iface.private_key }}'
{% for peer in iface.peers %}
config wireguard_{{ iface.name }}
        option description '{{ peer.description }}'
        option public_key '{{ peer.public_key }}'
        list allowed_ips '{{ peer.allowed_ips }}'
{% if peer.endpoint_host is defined %}
        option endpoint_host '{{ peer.endpoint_host }}'
        option endpoint_port '{{ peer.endpoint_port }}'
{% endif %}
{% if peer.persistent_keepalive is defined %}
        option persistent_keepalive '{{ peer.persistent_keepalive }}'
{% endif %}
{% endfor %}
{% endfor %}
{% endif %}


# VLAN section (DSA bridge-vlan) â€” optional
{% if vlans.enabled and (vlans.list | length) > 0 %}
{% for vlan in vlans.list %}
config bridge-vlan
        option device '{{ vlan.device }}'
        option vlan '{{ vlan.id }}'
{% for p in vlan.ports %}
        list ports '{{ p }}'
{% endfor %}

config interface '{{ vlan.iface.name }}'
        option device '{{ vlan.device }}.{{ vlan.id }}'
        option proto 'static'
        option ipaddr '{{ vlan.iface.address }}'
        option netmask '{{ vlan.iface.netmask }}'
{% endfor %}
{% endif %}
