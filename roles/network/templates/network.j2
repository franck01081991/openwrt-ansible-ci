# Generated by Ansible

# Bridge device for LAN (DSA)
config device
        option name '{{ network_config.lan.device }}'
        option type 'bridge'
{% for p in network_config.bridge_ports %}
        list ports '{{ p }}'
{% endfor %}

config interface 'lan'
        option device '{{ network_config.lan.device }}'
        option proto 'static'
        option ipaddr '{{ network_config.lan.ip }}'
        option netmask '{{ network_config.lan.netmask }}'

config interface 'wan'
        option device '{{ network_config.wan.device }}'
        option proto '{{ network_config.wan.proto | default("dhcp") }}'

{% if network_wireguard.enabled %}
{% for iface in network_wireguard.interfaces %}
config interface '{{ iface.name }}'
        option proto 'wireguard'
        list addresses '{{ iface.address }}'
        option listen_port '{{ iface.listen_port }}'
        option private_key '{{ iface.private_key }}'
{% for peer in iface.peers %}
config wireguard_{{ iface.name }}
        option description '{{ peer.description }}'
        option public_key '{{ peer.public_key }}'
        list allowed_ips '{{ peer.allowed_ips }}'
{% if peer.endpoint_host is defined %}
        option endpoint_host '{{ peer.endpoint_host }}'
        option endpoint_port '{{ peer.endpoint_port }}'
{% endif %}
{% if peer.persistent_keepalive is defined %}
        option persistent_keepalive '{{ peer.persistent_keepalive }}'
{% endif %}
{% endfor %}
{% endfor %}
{% endif %}


# VLAN section (DSA bridge-vlan) â€” optional
{% if network_vlans.enabled and (network_vlans.list | length) > 0 %}
{% for vlan in network_vlans.list %}
config bridge-vlan
        option device '{{ vlan.device }}'
        option vlan '{{ vlan.id }}'
{% for p in vlan.ports %}
        list ports '{{ p }}'
{% endfor %}

config interface '{{ vlan.iface.name }}'
        option device '{{ vlan.device }}.{{ vlan.id }}'
        option proto 'static'
        option ipaddr '{{ vlan.iface.address }}'
        option netmask '{{ vlan.iface.netmask }}'
{% endfor %}
{% endif %}

{% if network_vxlan.enabled and (network_vxlan.tunnels | length) > 0 %}
{% for vx in network_vxlan.tunnels %}
config interface '{{ vx.name }}'
        option proto 'vxlan'
        option id '{{ vx.id }}'
        option local '{{ vx.local }}'
        option remote '{{ vx.remote }}'
{% if vx.port is defined %}
        option port '{{ vx.port }}'
{% endif %}
{% if vx.device is defined %}
        option device '{{ vx.device }}'
{% endif %}
{% if vx.ipaddr is defined %}
        option ipaddr '{{ vx.ipaddr }}'
{% endif %}
{% endfor %}
{% endif %}

# Routing interfaces (optional)
{% if routing_interfaces is defined and (routing_interfaces | length) > 0 %}
{% for iface in routing_interfaces %}
config interface '{{ iface.name }}'
        option proto '{{ iface.proto | default('dhcp') }}'
{% if iface.device is defined %}
        option device '{{ iface.device }}'
{% endif %}
{% endfor %}
{% endif %}
